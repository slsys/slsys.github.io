import{_ as s,o as a,c as o,Q as l}from"./chunks/framework.f1c0562b.js";const u=JSON.parse('{"title":"Интеграция telegram","description":"","frontmatter":{},"headers":[],"relativePath":"telegram.md","filePath":"telegram.md"}'),n={name:"telegram.md"},p=l(`<h1 id="интеграция-telegram" tabindex="-1">Интеграция <a href="https://www.telegram.org" target="_blank" rel="noreferrer">telegram</a> <a class="header-anchor" href="#интеграция-telegram" aria-label="Permalink to &quot;Интеграция [telegram](https://www.telegram.org)&quot;">​</a></h1><h2 id="подключение-нового-бота" tabindex="-1">Подключение нового бота <a class="header-anchor" href="#подключение-нового-бота" aria-label="Permalink to &quot;Подключение нового бота&quot;">​</a></h2><p>Шлюз SLS позволяет напрямую подключать <a href="https://core.telegram.org/bots/" target="_blank" rel="noreferrer">ботов</a>. Один бот одновременно может использоваться только одним устройством, поэтому рекомендуется для каждого шлюза регистрировать отдельного бота. Прежде всего нужно получить токен. Для этого пишем боту <a href="https://t.me/BotFather" target="_blank" rel="noreferrer">@BotFather</a> команду <code>/newbot</code>, после этого даем боту имя и тэг. После этих действий бот отправит токен, который никому давать нельзя.</p><p><img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/24f/392/57a/24f39257a7893fab12efc0bd92c7bed4.png" alt="botfather"></p><p>Если вы желаете отправлять сообщения в Группу, необходимо в BotFather настроить режим конфиденциальности. Отключение режима конфиденциальности (для работы с группами):</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">/mybots</span></span>
<span class="line"><span style="color:#e1e4e8;">выбираете имя бота из списка</span></span>
<span class="line"><span style="color:#e1e4e8;">Bot settings</span></span>
<span class="line"><span style="color:#e1e4e8;">Group privacy</span></span>
<span class="line"><span style="color:#e1e4e8;">Disable</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">/mybots</span></span>
<span class="line"><span style="color:#24292e;">выбираете имя бота из списка</span></span>
<span class="line"><span style="color:#24292e;">Bot settings</span></span>
<span class="line"><span style="color:#24292e;">Group privacy</span></span>
<span class="line"><span style="color:#24292e;">Disable</span></span></code></pre></div><p>В итоге нужно получить такой ответ</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">Privacy mode (https://core.telegram.org/bots#privacy-mode) is disabled for your bot</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">Privacy mode (https://core.telegram.org/bots#privacy-mode) is disabled for your bot</span></span></code></pre></div><h2 id="chat-id" tabindex="-1">Chat ID <a class="header-anchor" href="#chat-id" aria-label="Permalink to &quot;Chat ID&quot;">​</a></h2><p>Отправка сообщений в группу Телеграмм или личные сообщения выполняется по идентификатору <code>chatid</code>, который имеет вид:</p><ul><li><code>-1001234567890</code> - группа</li><li><code>1234567890</code> - личные сообщения</li></ul><p>Существует множество вариантов получения <code>chatid</code> пользователя, бота или группы (канала), начиная с использования различных специализированных ботов <a href="https://t.me/getmyid_bot" target="_blank" rel="noreferrer">getmyid_bot</a> или с использованием стандартного <a href="https://core.telegram.org/api" target="_blank" rel="noreferrer">API</a></p><h3 id="id-группы" tabindex="-1">ID группы <a class="header-anchor" href="#id-группы" aria-label="Permalink to &quot;ID группы&quot;">​</a></h3><p>ID группы (канала, чата) можно получить как с помощью многочисленных ботов, так и с помощью стандартного API Телеграмм по <a href="https://it-stories.ru/blog/web-dev/kak-uznat-chat-id-dlja-kanala-gruppy-telegram/" target="_blank" rel="noreferrer">инструкции</a></p><div class="language-http vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">http</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">https://api.telegram.org/botBOT:TOKEN/getChat?chat_id=@имяканала</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">https://api.telegram.org/botBOT:TOKEN/getChat?chat_id=@имяканала</span></span></code></pre></div><ul><li>здесь: <ul><li><code>BOT:TOKEN</code> - реквизиты Вашего бота</li><li><code>@имяканала</code>- имя искомого чата, канала или группы</li></ul></li></ul><p>в ответ получим</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">{</span><span style="color:#FDAEB7;font-style:italic;">«ok»</span><span style="color:#E1E4E8;">:</span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;">,</span><span style="color:#FDAEB7;font-style:italic;">»result»</span><span style="color:#E1E4E8;">:{</span><span style="color:#FDAEB7;font-style:italic;">«id»</span><span style="color:#E1E4E8;">:</span><span style="color:#79B8FF;">-1001234567890</span><span style="color:#E1E4E8;">,</span><span style="color:#FDAEB7;font-style:italic;">»title»</span><span style="color:#E1E4E8;">:</span><span style="color:#FDAEB7;font-style:italic;">………</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">{</span><span style="color:#B31D28;font-style:italic;">«ok»</span><span style="color:#24292E;">:</span><span style="color:#005CC5;">true</span><span style="color:#24292E;">,</span><span style="color:#B31D28;font-style:italic;">»result»</span><span style="color:#24292E;">:{</span><span style="color:#B31D28;font-style:italic;">«id»</span><span style="color:#24292E;">:</span><span style="color:#005CC5;">-1001234567890</span><span style="color:#24292E;">,</span><span style="color:#B31D28;font-style:italic;">»title»</span><span style="color:#24292E;">:</span><span style="color:#B31D28;font-style:italic;">………</span></span></code></pre></div><ul><li>где <code>id</code> - <code>chatid</code> канала.</li></ul><h3 id="id-пользователя" tabindex="-1">ID Пользователя <a class="header-anchor" href="#id-пользователя" aria-label="Permalink to &quot;ID Пользователя&quot;">​</a></h3><p><code>chatid</code> пользователя проще получить с помощью бота <a href="https://t.me/getmyid_bot" target="_blank" rel="noreferrer">getmyid_bot</a></p><p>Если нужно получить свой ID, достаточно просто написать боту.</p><p>Если нужен ID другого пользователя, нужно переслать боту сообщение этого пользователя</p><p>Бот возвращает:</p><ul><li><code>Your user ID</code> - Ваш ID</li><li><code>Forwarded from</code> - ID пользователя, чата, группы или канала, из которого переслано сообщение</li></ul><h2 id="настроика-шлюза" tabindex="-1">Настройка шлюза <a class="header-anchor" href="#настроика-шлюза" aria-label="Permalink to &quot;Настройка шлюза&quot;">​</a></h2><p>Теперь требуется инициализировать бота в стартовом скрипте, для этого войдите в редактор скриптов <code>Actions-&gt;Files</code> и если ранее не создавали, создайте стартовый скрипт <code>init.lua</code>. Пропишите строки инициализации токена телеграмм как в примере:</p><div class="language-lua vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">lua</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">telegram.</span><span style="color:#79B8FF;">settoken</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;597******444:AAG4Nxe27**********rXDUgy7U&quot;</span><span style="color:#E1E4E8;">)   </span><span style="color:#6A737D;">--API-токен вашего бота</span></span>
<span class="line"><span style="color:#E1E4E8;">telegram.</span><span style="color:#79B8FF;">setchat</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;1234567890&quot;</span><span style="color:#E1E4E8;">)   </span><span style="color:#6A737D;">-- ChatID, куда бот будет писать сообщения</span></span>
<span class="line"><span style="color:#E1E4E8;">telegram.</span><span style="color:#79B8FF;">receive</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;">[, period])   </span><span style="color:#6A737D;">--обрабатывать входящие сообщения. По умолчанию выключен. Period - частота приема входящих сообщений в мс, не менее 1000. По умолчанию 1000мс.</span></span>
<span class="line"><span style="color:#E1E4E8;">telegram.</span><span style="color:#79B8FF;">send</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;SLS  загружен &quot;</span><span style="color:#F97583;">..</span><span style="color:#E1E4E8;">net.</span><span style="color:#79B8FF;">localIP</span><span style="color:#E1E4E8;">()) </span><span style="color:#6A737D;">--отправит сообщение с локальным адресом SLS в вашей сети в телеграм</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">telegram.</span><span style="color:#005CC5;">settoken</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;597******444:AAG4Nxe27**********rXDUgy7U&quot;</span><span style="color:#24292E;">)   </span><span style="color:#6A737D;">--API-токен вашего бота</span></span>
<span class="line"><span style="color:#24292E;">telegram.</span><span style="color:#005CC5;">setchat</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;1234567890&quot;</span><span style="color:#24292E;">)   </span><span style="color:#6A737D;">-- ChatID, куда бот будет писать сообщения</span></span>
<span class="line"><span style="color:#24292E;">telegram.</span><span style="color:#005CC5;">receive</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">true</span><span style="color:#24292E;">[, period])   </span><span style="color:#6A737D;">--обрабатывать входящие сообщения. По умолчанию выключен. Period - частота приема входящих сообщений в мс, не менее 1000. По умолчанию 1000мс.</span></span>
<span class="line"><span style="color:#24292E;">telegram.</span><span style="color:#005CC5;">send</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;SLS  загружен &quot;</span><span style="color:#D73A49;">..</span><span style="color:#24292E;">net.</span><span style="color:#005CC5;">localIP</span><span style="color:#24292E;">()) </span><span style="color:#6A737D;">--отправит сообщение с локальным адресом SLS в вашей сети в телеграм</span></span></code></pre></div><h2 id="о-безопасности" tabindex="-1">О безопасности <a class="header-anchor" href="#о-безопасности" aria-label="Permalink to &quot;О безопасности&quot;">​</a></h2><p>По умолчанию включена отправка на сервер по протоколу http. Если вы желаете использовать https, небходимо при инициализации указать:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">telegram.secure(true)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">telegram.secure(true)</span></span></code></pre></div><p><strong>Внимание! Включение этой опции отнимает большое количество свободной памяти, возможны частые перезагрузки шлюза.</strong></p><h2 id="отправка-сообщении" tabindex="-1">Отправка сообщений <a class="header-anchor" href="#отправка-сообщении" aria-label="Permalink to &quot;Отправка сообщений&quot;">​</a></h2><p>Сообщения отправляются из скриптов LUA командой</p><div class="language-lua vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">lua</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">telegram.</span><span style="color:#79B8FF;">send</span><span style="color:#E1E4E8;">(msg[, chatid, parse_mode])</span></span>
<span class="line"><span style="color:#6A737D;">-- msg - STR, сообщение </span></span>
<span class="line"><span style="color:#6A737D;">-- chatid - STR, ID чата, куда бот будет писать сообщения</span></span>
<span class="line"><span style="color:#6A737D;">-- parse_mode - STR, можно использовать для отправки ReplyKeyboard</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">telegram.</span><span style="color:#005CC5;">send</span><span style="color:#24292E;">(msg[, chatid, parse_mode])</span></span>
<span class="line"><span style="color:#6A737D;">-- msg - STR, сообщение </span></span>
<span class="line"><span style="color:#6A737D;">-- chatid - STR, ID чата, куда бот будет писать сообщения</span></span>
<span class="line"><span style="color:#6A737D;">-- parse_mode - STR, можно использовать для отправки ReplyKeyboard</span></span></code></pre></div><p>Например:</p><div class="language-lua vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">lua</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">telegram.</span><span style="color:#79B8FF;">send</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;hello world&#39;</span><span style="color:#E1E4E8;">)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">telegram.</span><span style="color:#005CC5;">send</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;hello world&#39;</span><span style="color:#24292E;">)</span></span></code></pre></div><h2 id="обработка-входящих-сообщении" tabindex="-1">Обработка входящих сообщений <a class="header-anchor" href="#обработка-входящих-сообщении" aria-label="Permalink to &quot;Обработка входящих сообщений&quot;">​</a></h2><h3 id="события" tabindex="-1">События <a class="header-anchor" href="#события" aria-label="Permalink to &quot;События&quot;">​</a></h3><p>В скрипте обработки доступны слкдующие события:</p><ul><li><code>Event.Telegram.ChatId</code> - ID пользователя (chatid)</li><li><code>Event.Telegram.Username</code> - логин</li><li><code>Event.Telegram.Name</code> - Имя пользователя</li><li><code>Event.Telegram.MessageId</code> - ID сообщения</li><li><code>Event.Telegram.Text</code> - текст сообщения</li></ul><p>Для обработки входящих сообщений необходимо создать файл <code>tlg.lua</code>. Пример файла:</p><div class="language-lua vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">lua</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (Event.</span><span style="color:#B392F0;">Telegram</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">Text</span><span style="color:#F97583;">==</span><span style="color:#9ECBFF;">&quot;Info&quot;</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">then</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">dofile</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;/int/info.lua&quot;</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">end</span><span style="color:#E1E4E8;">   </span><span style="color:#6A737D;">-- при получениие сообщения, содержащего &quot;Info&quot; запускать сценарий info.lua</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (Event.</span><span style="color:#6F42C1;">Telegram</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">Text</span><span style="color:#D73A49;">==</span><span style="color:#032F62;">&quot;Info&quot;</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">then</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">dofile</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;/int/info.lua&quot;</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">end</span><span style="color:#24292E;">   </span><span style="color:#6A737D;">-- при получениие сообщения, содержащего &quot;Info&quot; запускать сценарий info.lua</span></span></code></pre></div><p>Теперь при получении сообщения <code>Info</code> в просматриваемом чате будет запускаться скрипт /int/info.lua, в который можно поместить например отправку информации о шлюзе:</p><div class="language-lua vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">lua</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">local</span><span style="color:#E1E4E8;"> remip </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> http.</span><span style="color:#79B8FF;">request</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;http://wtfismyip.com/text&quot;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">uptime</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">os.</span><span style="color:#79B8FF;">millis</span><span style="color:#E1E4E8;">()</span></span>
<span class="line"><span style="color:#E1E4E8;">uptime_s</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">math.floor</span><span style="color:#E1E4E8;">(uptime</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">1000</span><span style="color:#E1E4E8;">)</span><span style="color:#F97583;">%</span><span style="color:#79B8FF;">60</span></span>
<span class="line"><span style="color:#E1E4E8;">uptime_m</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">math.floor</span><span style="color:#E1E4E8;">(uptime</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">1000</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">60</span><span style="color:#E1E4E8;">)</span><span style="color:#F97583;">%</span><span style="color:#79B8FF;">60</span></span>
<span class="line"><span style="color:#E1E4E8;">uptime_h</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">math.floor</span><span style="color:#E1E4E8;">(uptime</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">1000</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">60</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">60</span><span style="color:#E1E4E8;">)</span><span style="color:#F97583;">%</span><span style="color:#79B8FF;">24</span></span>
<span class="line"><span style="color:#E1E4E8;">uptime_d</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">math.floor</span><span style="color:#E1E4E8;">(uptime</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">1000</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">60</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">60</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">24</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">msg</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;SLS XIAOMI  is working  &quot;</span><span style="color:#F97583;">..</span><span style="color:#E1E4E8;">net.</span><span style="color:#79B8FF;">localIP</span><span style="color:#E1E4E8;">()</span><span style="color:#F97583;">..</span><span style="color:#9ECBFF;">&quot;, &quot;</span><span style="color:#F97583;">..</span><span style="color:#E1E4E8;">remip</span></span>
<span class="line"><span style="color:#E1E4E8;">msg</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">msg</span><span style="color:#F97583;">..</span><span style="color:#9ECBFF;">&quot;</span><span style="color:#79B8FF;">\\n\\r</span><span style="color:#9ECBFF;">&quot;</span><span style="color:#F97583;">..</span><span style="color:#9ECBFF;">&quot;Uptime: &quot; </span><span style="color:#F97583;">..</span><span style="color:#E1E4E8;"> uptime_d  </span><span style="color:#F97583;">..</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;d &quot;</span><span style="color:#F97583;">..</span><span style="color:#E1E4E8;"> uptime_h </span><span style="color:#F97583;">..</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;:&quot; </span><span style="color:#F97583;">..</span><span style="color:#E1E4E8;"> uptime_m</span><span style="color:#F97583;">..</span><span style="color:#9ECBFF;">&quot;:&quot;</span><span style="color:#F97583;">..</span><span style="color:#E1E4E8;">uptime_s</span></span>
<span class="line"><span style="color:#E1E4E8;">msg</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">msg</span><span style="color:#F97583;">..</span><span style="color:#9ECBFF;">&quot;</span><span style="color:#79B8FF;">\\n\\r</span><span style="color:#9ECBFF;">&quot;</span><span style="color:#F97583;">..</span><span style="color:#9ECBFF;">&quot;Free heap: &quot;</span><span style="color:#F97583;">..</span><span style="color:#E1E4E8;">os.</span><span style="color:#79B8FF;">freeMem</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;heap&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">msg</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">msg</span><span style="color:#F97583;">..</span><span style="color:#9ECBFF;">&quot;</span><span style="color:#79B8FF;">\\n\\r</span><span style="color:#9ECBFF;">&quot;</span><span style="color:#F97583;">..</span><span style="color:#9ECBFF;">&quot;Free psram: &quot;</span><span style="color:#F97583;">..</span><span style="color:#E1E4E8;">os.</span><span style="color:#79B8FF;">freeMem</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;psram&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">telegram.</span><span style="color:#79B8FF;">send</span><span style="color:#E1E4E8;">(msg)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">local</span><span style="color:#24292E;"> remip </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> http.</span><span style="color:#005CC5;">request</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;http://wtfismyip.com/text&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">uptime</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">os.</span><span style="color:#005CC5;">millis</span><span style="color:#24292E;">()</span></span>
<span class="line"><span style="color:#24292E;">uptime_s</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">math.floor</span><span style="color:#24292E;">(uptime</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">1000</span><span style="color:#24292E;">)</span><span style="color:#D73A49;">%</span><span style="color:#005CC5;">60</span></span>
<span class="line"><span style="color:#24292E;">uptime_m</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">math.floor</span><span style="color:#24292E;">(uptime</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">1000</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">60</span><span style="color:#24292E;">)</span><span style="color:#D73A49;">%</span><span style="color:#005CC5;">60</span></span>
<span class="line"><span style="color:#24292E;">uptime_h</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">math.floor</span><span style="color:#24292E;">(uptime</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">1000</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">60</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">60</span><span style="color:#24292E;">)</span><span style="color:#D73A49;">%</span><span style="color:#005CC5;">24</span></span>
<span class="line"><span style="color:#24292E;">uptime_d</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">math.floor</span><span style="color:#24292E;">(uptime</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">1000</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">60</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">60</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">24</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">msg</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;SLS XIAOMI  is working  &quot;</span><span style="color:#D73A49;">..</span><span style="color:#24292E;">net.</span><span style="color:#005CC5;">localIP</span><span style="color:#24292E;">()</span><span style="color:#D73A49;">..</span><span style="color:#032F62;">&quot;, &quot;</span><span style="color:#D73A49;">..</span><span style="color:#24292E;">remip</span></span>
<span class="line"><span style="color:#24292E;">msg</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">msg</span><span style="color:#D73A49;">..</span><span style="color:#032F62;">&quot;</span><span style="color:#005CC5;">\\n\\r</span><span style="color:#032F62;">&quot;</span><span style="color:#D73A49;">..</span><span style="color:#032F62;">&quot;Uptime: &quot; </span><span style="color:#D73A49;">..</span><span style="color:#24292E;"> uptime_d  </span><span style="color:#D73A49;">..</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;d &quot;</span><span style="color:#D73A49;">..</span><span style="color:#24292E;"> uptime_h </span><span style="color:#D73A49;">..</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;:&quot; </span><span style="color:#D73A49;">..</span><span style="color:#24292E;"> uptime_m</span><span style="color:#D73A49;">..</span><span style="color:#032F62;">&quot;:&quot;</span><span style="color:#D73A49;">..</span><span style="color:#24292E;">uptime_s</span></span>
<span class="line"><span style="color:#24292E;">msg</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">msg</span><span style="color:#D73A49;">..</span><span style="color:#032F62;">&quot;</span><span style="color:#005CC5;">\\n\\r</span><span style="color:#032F62;">&quot;</span><span style="color:#D73A49;">..</span><span style="color:#032F62;">&quot;Free heap: &quot;</span><span style="color:#D73A49;">..</span><span style="color:#24292E;">os.</span><span style="color:#005CC5;">freeMem</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;heap&#39;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">msg</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">msg</span><span style="color:#D73A49;">..</span><span style="color:#032F62;">&quot;</span><span style="color:#005CC5;">\\n\\r</span><span style="color:#032F62;">&quot;</span><span style="color:#D73A49;">..</span><span style="color:#032F62;">&quot;Free psram: &quot;</span><span style="color:#D73A49;">..</span><span style="color:#24292E;">os.</span><span style="color:#005CC5;">freeMem</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;psram&#39;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">telegram.</span><span style="color:#005CC5;">send</span><span style="color:#24292E;">(msg)</span></span></code></pre></div><p>Данный скрипт отправит локальный / внешний ip, количество свободной памяти и время работы шлюза.</p><h2 id="отправка-кнопок-replykeyboard" tabindex="-1">Отправка кнопок ReplyKeyboard <a class="header-anchor" href="#отправка-кнопок-replykeyboard" aria-label="Permalink to &quot;Отправка кнопок ReplyKeyboard&quot;">​</a></h2><p>Шлюз может отправить сообщение <a href="https://core.telegram.org/api/bots%2Fbuttons" target="_blank" rel="noreferrer">replyKeyboard</a></p><div class="language-lua vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">lua</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">telegram.</span><span style="color:#79B8FF;">send</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;Главное меню&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;chatid&quot;</span><span style="color:#E1E4E8;">,</span><span style="color:#9ECBFF;">&quot;parse_mode=MarkdownV2&amp;reply_markup={</span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#9ECBFF;">keyboard</span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#9ECBFF;">:[[</span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#9ECBFF;">Температуры</span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#9ECBFF;">],[</span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#9ECBFF;">Info</span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#9ECBFF;">,</span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#9ECBFF;">cmd3</span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#9ECBFF;">]],</span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#9ECBFF;">resize_keyboard</span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#9ECBFF;">:true,</span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#9ECBFF;">one_time_keyboard</span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#9ECBFF;">:true}&quot;</span><span style="color:#E1E4E8;">)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">telegram.</span><span style="color:#005CC5;">send</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;Главное меню&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;chatid&quot;</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&quot;parse_mode=MarkdownV2&amp;reply_markup={</span><span style="color:#005CC5;">\\&quot;</span><span style="color:#032F62;">keyboard</span><span style="color:#005CC5;">\\&quot;</span><span style="color:#032F62;">:[[</span><span style="color:#005CC5;">\\&quot;</span><span style="color:#032F62;">Температуры</span><span style="color:#005CC5;">\\&quot;</span><span style="color:#032F62;">],[</span><span style="color:#005CC5;">\\&quot;</span><span style="color:#032F62;">Info</span><span style="color:#005CC5;">\\&quot;</span><span style="color:#032F62;">,</span><span style="color:#005CC5;">\\&quot;</span><span style="color:#032F62;">cmd3</span><span style="color:#005CC5;">\\&quot;</span><span style="color:#032F62;">]],</span><span style="color:#005CC5;">\\&quot;</span><span style="color:#032F62;">resize_keyboard</span><span style="color:#005CC5;">\\&quot;</span><span style="color:#032F62;">:true,</span><span style="color:#005CC5;">\\&quot;</span><span style="color:#032F62;">one_time_keyboard</span><span style="color:#005CC5;">\\&quot;</span><span style="color:#032F62;">:true}&quot;</span><span style="color:#24292E;">)</span></span></code></pre></div>`,49),e=[p];function t(r,c,y,i,E,d){return a(),o("div",null,e)}const h=s(n,[["render",t]]);export{u as __pageData,h as default};
