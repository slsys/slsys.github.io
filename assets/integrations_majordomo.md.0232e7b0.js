import{_ as e,a,b as t,c as o,d as s,e as r,f as i,g as p,h as n,i as l,j as m,k as c,l as g,m as d,n as h,o as b,p as q,q as u,r as _,s as z,t as k}from"./chunks/slslog.91c83e60.js";import{_ as f,o as v,c as j,Q as y}from"./chunks/framework.f1c0562b.js";const M="/assets/sd4.4eccdf22.png",T=JSON.parse('{"title":"Описание","description":"","frontmatter":{},"headers":[],"relativePath":"integrations/majordomo.md","filePath":"integrations/majordomo.md"}'),S={name:"integrations/majordomo.md"},w=y('<h1 id="описание" tabindex="-1">Описание <a class="header-anchor" href="#описание" aria-label="Permalink to &quot;Описание&quot;">​</a></h1><p>Модуль для интеграции устройств Zigbee или BLE для систем автоматизации на базе <a href="https://mjdm.ru/" target="_blank" rel="noreferrer">MajorDoMo</a>. Для интеграции могут быть использованы программный продукт <a href="https://www.zigbee2mqtt.io" target="_blank" rel="noreferrer">zigbee2mqtt</a> совместно с разлиными вариантами zigbee-донглов, либо готовый апаратный шлюз Smart Logic System (SLS) Zigbee BLE gateway. Модуль позволяет одновременно работать с неограниченным количеством шлюзов или приложений zigbee2mqtt, представляя собой клиента mqtt и готовый набор базы данных поддерживаемых устройств. Использование модуля избавляет пользователя от необходимости прописывания и запоминания метрик устройств.</p><p><img src="'+e+'" alt="home"></p><h1 id="подготовительные-меропрития" tabindex="-1">Подготовительные меропрития <a class="header-anchor" href="#подготовительные-меропрития" aria-label="Permalink to &quot;Подготовительные меропрития&quot;">​</a></h1><p>Модуль работает через MQTT. Установка mosqutto на raspberry или linux:</p><p><a href="https://robot-on.ru/articles/ystanovka-mqtt-brokera-mosquitto-raspberry-orange-pi" target="_blank" rel="noreferrer">ссылка 1</a></p><p><a href="https://smartideal.net/ustanovka-i-zapusk-mqtt-brokera-mosquitto/" target="_blank" rel="noreferrer">ссылка 2</a></p><p>Mosqutto для windows можно скачать <a href="https://mosquitto.org/download/" target="_blank" rel="noreferrer">тут</a></p><p>Для корректной работы с MajorDoMo необходимо через маркет дополнений установить модуль <a href="https://connect.smartliving.ru/tasks/355.html" target="_blank" rel="noreferrer">zigbee2mqtt</a>.</p><p>После установки mqtt брокера и дополнения для MajorDomo, необходимо на вкладке Сервис прописать нужные настройки:</p><ol><li><p>адрес mqtt сервера</p></li><li><p>порт mqtt</p></li><li><p>если необходимо, то логин и пароль mqtt</p></li><li><p>Subscription path - путь для подписки модуля. Если вы используте несколько шлюзов, то каждый из шлюзов необходимо указать через запятую, например так:</p></li></ol><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">ZigBeeCA20/#,zigbee2mqtt/#</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">ZigBeeCA20/#,zigbee2mqtt/#</span></span></code></pre></div><ol start="5"><li><p>Если zigbee2mqtt установлен на этой же машине нативно, или через docker, можно настроить просмотр лога zigbee2mqtt, указав путь до приложения, например /opt/zigbee2mqtt</p></li><li><p>Для просмотра лога SLS шлюза, необходимо указать его ip адрес в формате 192.168.1.93.</p></li></ol><p>Остальные настройки по желанию.</p><p><img src="'+a+'" alt="settings"></p><p>После нажатия кнопки сохранить, происходит перезапуск цикла zigbee2mqtt. Его статус можно посмотреть в XRAY на вкладке Services. При необходимости, там же его можно перезапустить или остановить.</p><p><strong>Для корректной работы модуля, необходимо на вкладке Сервис нажать кнопку Disable strict mode - это выключит строгий режим MySQL сервера.</strong></p><p><img src="'+t+'" alt="settingss"></p><h1 id="добавление-сопряжение-устроиств" tabindex="-1">Добавление (сопряжение) устройств <a class="header-anchor" href="#добавление-сопряжение-устроиств" aria-label="Permalink to &quot;Добавление (сопряжение) устройств&quot;">​</a></h1><p>Для добавления устройств Zigbee, необходимо на шлюзе включить режим сопряжения. Сделать это можно через Web-интерфейс шлюза SLS, или из модуля MajorDomo. Режим переключается на вкладке Сервис, либо нажатием на &quot;Сопряжение [имя_шлюза]&quot;. Когда индикатор сопряжения горит зеленым, шлюз готов к сопряжению. Для шлюзов на базе Zigbee 3 максимально разрешенное время режима сопряжения составляет 5 минут.</p><p><img src="'+o+'" alt="permit"></p><p>После включения режима сопряжения, необходимо на устройстве нажать кнопку сброса в соответствии с инструкцией. Узнать, каким образом устройство можно перевести в режим сопряжения можно в каталоге <a href="https://www.zigbee2mqtt.io/information/supported_devices.html" target="_blank" rel="noreferrer">zigbee2mqtt</a>.</p><h1 id="управление-устроиствами-с-панели-управления" tabindex="-1">Управление устройствами с панели управления <a class="header-anchor" href="#управление-устроиствами-с-панели-управления" aria-label="Permalink to &quot;Управление устройствами с панели управления&quot;">​</a></h1><p>Управляемым устройствам можно давать команды в панели администратора модуля для MajorDoMo. У таких устройств в верхней полоске находятся кнопки управления в соответсвии с типом устройства. Нажатие на соответсвующие пиктограммы изменяет режим.</p><p><img src="'+s+'" alt="remote"></p><p>При нажатии на картинку устройства - отправляется команда &quot;toggle&quot;, которая изменяет режим на противоположный.</p><h1 id="управление-устроиствами-через-приложения" tabindex="-1">Управление устройствами через приложения <a class="header-anchor" href="#управление-устроиствами-через-приложения" aria-label="Permalink to &quot;Управление устройствами через приложения&quot;">​</a></h1><p>Интерфейс управления модулем доступен из приложений. Так, установив приложение для телефонов Majordroid, через приложения будет доступен режим простотра и управления устройстами.</p><p><img src="'+r+'" alt="majordroid1"><img src="'+i+'" alt="majordroid2"></p><p>Также постоянную странциу дополнения <a href="http:/192.168.1.39/module/zigbee2mqtt.html" target="_blank" rel="noreferrer">http:/ipaddr/module/zigbee2mqtt.html</a> можно прописать в ибзранном или домашней странций браузера.</p><p><img src="'+p+'" alt="app"></p><p>Отсюда также можно управлять устройствами. Ссылку на эту страницу можно установить домашней страницей на настенном планшете или анлогичном устройстве в домашней сети.</p><p><img src="'+n+'" alt="app2"></p><h1 id="привязка-устроиств-к-объектам" tabindex="-1">Привязка устройств к объектам <a class="header-anchor" href="#привязка-устроиств-к-объектам" aria-label="Permalink to &quot;Привязка устройств к объектам&quot;">​</a></h1><p>Дополнение zigbee2mqtt адамтировано для интеграции с <a href="https://kb.mjdm.ru/devices_help/" target="_blank" rel="noreferrer">&quot;Простыми устройствами&quot;</a> MajorDoMo. Через вкадку &quot;Простые устройства&quot; панели администратора необходимо выбрать и добавить в систему подходящее по смыслу устройство(например &quot;Датчик движения&quot; или &quot;Управляемое реле&quot;)</p><p><img src="'+l+'" alt="sd1"><img src="'+m+'" alt="sd2"> После его добавления, необходимо узнать и запомнить название связанного объекта: <img src="'+c+'" alt="sd2"></p><p>Теперь в панели администратора модуля zigbee2mqtt небходимо найти нужное устройство и зайти на вкладку &quot;Данные&quot;: <img src="'+g+'" alt="sd2"></p><p>Выбрать подходящую метрику устройства: <img src="'+M+'" alt="sd2"> И привязать ранее созданный объект как на картинке: <img src="'+d+'" alt="sd2"><img src="'+h+'" alt="sd2"></p><p>Теперь метрики вашего устройства связаны с логикой работы MajorDoMo. Вы можете получать соответсвующие уведомления, настраивать реакции, управлять устройствами с помощью имеющихся инструментов, в точ числе с помощью <a href="https://kb.mjdm.ru/category/oborudovanie/golosovoe-upravlenie-umnim-domom-majordomo/" target="_blank" rel="noreferrer">голосовых команд</a>.</p><p>** Обратите внимание, что получаемые от пультов метрики click, command и тд. реверсятся. Это возволяет использовать разные настройки для поддерживаемых команд (двойной тап, двойное нажатие, долгое нажатие и тд). Привязывать нужно необходимую команду, например single (double, long) вместо метрики click. Если привязать click к нужному действию, событие будет выполняться на каждоей действие (нажати, отпускание и тд). <img src="'+b+'" alt="sd8"></p><p>** Также стоит отметить, что для &quot;Простых устройств&quot; типа реле, диммер и т.д. лучше привязывать метод switch, тогда логика управления будет соблюдена. Для датчиков нужно привязывать соотстветсвующие метрики. **</p><p>** Внимание!!! Одновременная привязка метода и свойства для кнопок будет вызывать двойную сработку.</p><h1 id="группы" tabindex="-1">Группы <a class="header-anchor" href="#группы" aria-label="Permalink to &quot;Группы&quot;">​</a></h1><p>Объединение устройств в группы позволяет устройствам подписываться на групповые команлы, тем самым избавляя пользователя или систему домашней автоматизации в необходимости отправки команд каждому устройству. Также намного ускоряется время реакции устройств по сравнению с циклической отправкой.</p><p>Добавление устройств в группы производится со вкладки Edit Device. Можно создать новую группу или выбрать из имеющихся.</p><p><img src="'+q+'" alt="gr"></p><p>Далее согласно протоколу zigbee2mqtt создается новое устройство с именем группы. Отправляя одну команду в группу можно изменить режим работы всех включенных в нее устройств.</p><p>Протоколом zigbee предусмотена поддержка устройствами нахождение в нескольких группах. Перечитать список групп, куда входит устройство можно со вкладки Parameters</p><p><img src="'+u+'" alt="gr2"></p><p>В панели администратора можно выбрать режим отображения &quot;только группы&quot;. <img src="'+_+'" alt="gr2"></p><h1 id="touchlink" tabindex="-1">TouchLink <a class="header-anchor" href="#touchlink" aria-label="Permalink to &quot;TouchLink&quot;">​</a></h1><p>Протоколом zigbee предусмотрено управление устройствами без координатора. Технология TouchLink позволяет создать отдельную сеть zigbee между двумя устройствами. Для связи поддерживающих технологию устройств, необхолимо ознакомиться с документацией. В магазинах Ikea продаются комплекты ламп и пультов Tradfri, которые поддерживают такое сопряжение. Обычно для сопряжения лампы и пульта, необходимо поднести пульт к включенной лампочке и нажать кнопку сопряжения. Через какое-то время лампа начнет моргать с нарастающей частотой. Через какое-то время моргание остановится, устройства должны будут создать свою сеть и прописаться на события устройств.</p><h1 id="binding" tabindex="-1">Binding <a class="header-anchor" href="#binding" aria-label="Permalink to &quot;Binding&quot;">​</a></h1><p>Протоколом zigbee также предусмотрена настройки связей устройств с координатора. Такая технология называется Binding. Он позволяет аналогичным образом подписать одни устройства (лампы) на другие (пульты, датчики), только настройка осуществляется через координатор. Это дает возможности более тонкой настройки связей без создания отдельной сети zigbee.</p><h1 id="просмотр-логов-zigbee2mqtt-или-sls-zgw" tabindex="-1">Просмотр логов zigbee2mqtt или SLS ZGW <a class="header-anchor" href="#просмотр-логов-zigbee2mqtt-или-sls-zgw" aria-label="Permalink to &quot;Просмотр логов zigbee2mqtt или SLS ZGW&quot;">​</a></h1><p>В дополнении для MajorDoMo предусмотрен просмотр log файла программного шлюза. Если zigbee2mqtt установлен на одном сервере, где установлен MajorDoMo, необходимо на вкладке Настройка в поле Folder path указать путь, куда установлен zigbee2mqtt. Инструкции по-умполчанию устанавливают в папку /opt/zigbee2mqtt. В результате становится доступен просмотр файл журнала zigbee2mqtt.</p><p><img src="'+z+'" alt="z2mlog"></p><p>Для аппаратного шлюза SLS в режиме проксирования доступен просмотр журнала работы. Необходимо на вкладке Настройка в поле SLS ZGW IP adress указать ip-адресс шлюза. Просмотр доступен на вкладке SLS log.</p><p><img src="'+k+`" alt="slslog"></p><h1 id="пример-сценария-majoromo-для-перезагрузки-шлюза" tabindex="-1">Пример сценария Majoromo для перезагрузки шлюза <a class="header-anchor" href="#пример-сценария-majoromo-для-перезагрузки-шлюза" aria-label="Permalink to &quot;Пример сценария  Majoromo для перезагрузки шлюза&quot;">​</a></h1><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">include_once(DIR_MODULES . &#39;zigbee2mqtt/zigbee2mqtt.class.php&#39;);</span></span>
<span class="line"><span style="color:#e1e4e8;">$z2m = new zigbee2mqtt();</span></span>
<span class="line"><span style="color:#e1e4e8;">$z2m-&gt;sendcommand(&#39;ZigBeeXXXX/reboot&#39;, &#39;&#39;);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">include_once(DIR_MODULES . &#39;zigbee2mqtt/zigbee2mqtt.class.php&#39;);</span></span>
<span class="line"><span style="color:#24292e;">$z2m = new zigbee2mqtt();</span></span>
<span class="line"><span style="color:#24292e;">$z2m-&gt;sendcommand(&#39;ZigBeeXXXX/reboot&#39;, &#39;&#39;);</span></span></code></pre></div><h1 id="пример-сценария-majoromo-для-установки-подстветки-модернизированного-шлюза-aqara" tabindex="-1">Пример сценария Majoromo для установки подстветки модернизированного шлюза Aqara <a class="header-anchor" href="#пример-сценария-majoromo-для-установки-подстветки-модернизированного-шлюза-aqara" aria-label="Permalink to &quot;Пример сценария  Majoromo для установки подстветки модернизированного шлюза Aqara&quot;">​</a></h1><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">include_once(DIR_MODULES . &#39;zigbee2mqtt/zigbee2mqtt.class.php&#39;);</span></span>
<span class="line"><span style="color:#e1e4e8;">$z2m = new zigbee2mqtt();</span></span>
<span class="line"><span style="color:#e1e4e8;">$z2m-&gt;sendcommand(&#39;ZigBeeXXXX/led&#39;, &#39;{“mode”:”manual”,”hex”:”#FF0000”}&#39;);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">include_once(DIR_MODULES . &#39;zigbee2mqtt/zigbee2mqtt.class.php&#39;);</span></span>
<span class="line"><span style="color:#24292e;">$z2m = new zigbee2mqtt();</span></span>
<span class="line"><span style="color:#24292e;">$z2m-&gt;sendcommand(&#39;ZigBeeXXXX/led&#39;, &#39;{“mode”:”manual”,”hex”:”#FF0000”}&#39;);</span></span></code></pre></div><h1 id="пример-сценария-majoromo-для-открытия-закрытия-привода-для-штор-aqara" tabindex="-1">Пример сценария Majoromo для открытия/закрытия привода для штор Aqara <a class="header-anchor" href="#пример-сценария-majoromo-для-открытия-закрытия-привода-для-штор-aqara" aria-label="Permalink to &quot;Пример сценария Majoromo для открытия/закрытия привода для штор Aqara&quot;">​</a></h1><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">include_once(DIR_MODULES . &#39;zigbee2mqtt/zigbee2mqtt.class.php&#39;);</span></span>
<span class="line"><span style="color:#e1e4e8;">$z2m = new zigbee2mqtt();</span></span>
<span class="line"><span style="color:#e1e4e8;">$z2m-&gt;sendcommand(&#39;ZigBeeXXXX/0x00158D0002EE1285/set&#39;, &#39;{&quot;state&quot;:&quot;open&quot;}&#39;);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">include_once(DIR_MODULES . &#39;zigbee2mqtt/zigbee2mqtt.class.php&#39;);</span></span>
<span class="line"><span style="color:#24292e;">$z2m = new zigbee2mqtt();</span></span>
<span class="line"><span style="color:#24292e;">$z2m-&gt;sendcommand(&#39;ZigBeeXXXX/0x00158D0002EE1285/set&#39;, &#39;{&quot;state&quot;:&quot;open&quot;}&#39;);</span></span></code></pre></div><p>где 0x00158D0002EE1285 - IEEE адрес вашего привода.</p><h1 id="полезные-ссылки" tabindex="-1">Полезные ссылки <a class="header-anchor" href="#полезные-ссылки" aria-label="Permalink to &quot;Полезные ссылки&quot;">​</a></h1><p>Ссылка на интересный тематический канал в телеграм: <a href="https://t.me/zigbeer" target="_blank" rel="noreferrer">https://t.me/zigbeer</a></p><p>Ссылка на репозиторий модуля zigbee2mqtt: <a href="http://github.com/directman66/majordomo-zigbee2mqtt/" target="_blank" rel="noreferrer">http://github.com/directman66/majordomo-zigbee2mqtt/</a></p><p>Топики для управления устройствами через mqtt <a href="https://www.zigbee2mqtt.io/integration/home_assistant.html" target="_blank" rel="noreferrer">https://www.zigbee2mqtt.io/integration/home_assistant.html</a></p><p>Топики для управления шлюзом через mqtt <a href="https://www.zigbee2mqtt.io/information/mqtt_topics_and_message_structure.html#zigbee2mqttbridgelog" target="_blank" rel="noreferrer">https://www.zigbee2mqtt.io/information/mqtt_topics_and_message_structure.html#zigbee2mqttbridgelog</a></p>`,71),D=[w];function X(x,L,E,P,$,B){return v(),j("div",null,D)}const I=f(S,[["render",X]]);export{T as __pageData,I as default};
