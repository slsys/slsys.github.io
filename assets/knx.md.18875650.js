import{_ as s,o as a,c as n,Q as l}from"./chunks/framework.f1c0562b.js";const h=JSON.parse('{"title":"KNX","description":"","frontmatter":{},"headers":[],"relativePath":"knx.md","filePath":"knx.md"}'),p={name:"knx.md"},o=l(`<h1 id="knx" tabindex="-1">KNX <a class="header-anchor" href="#knx" aria-label="Permalink to &quot;KNX&quot;">​</a></h1><p><strong>Функционал поддерживается только для <a href="/sls_pro">Pro</a> версии.</strong></p><p>Шлюз поддерживает работу по протоколу KNX начиная с версии <em>2022.01.07d10</em>.</p><p>Шлюз работает в режиме монитора шины и все обнаруженные групповые объекты сохраняются во внутренней базе данных. На данный момент она рассчитана на 1000 адресов, возможно увеличение количества в дальнейшем.</p><h2 id="варианты-подключения" tabindex="-1">Варианты подключения <a class="header-anchor" href="#варианты-подключения" aria-label="Permalink to &quot;Варианты подключения&quot;">​</a></h2><ol><li>KNX TP (медная шина) - требует специализированного модуля сопряжения (в разработке)</li><li>KNXnetIP/Tunneling (unicast) - подключение к KNX IP Interface / Router</li><li>KNXnetIP Routing (multicast) - в данный момент не планируется, т.к. не гарантируется доставка пакетов</li></ol><h2 id="программирование-через-ets" tabindex="-1">Программирование через ETS <a class="header-anchor" href="#программирование-через-ets" aria-label="Permalink to &quot;Программирование через ETS&quot;">​</a></h2><p>Планируется добавить функционал для программирования KNX через шлюз, т.е. использование шлюза как полноценного IP Interface.</p><p>При этом объекты находящиеся в базе будут отдаваться на запрос чтения без физического запроса в шину TP (кэширование), что значительно повышает скорость запуска визуализаций.</p><h2 id="knxnetip-tunneling" tabindex="-1">KNXnetIP/Tunneling <a class="header-anchor" href="#knxnetip-tunneling" aria-label="Permalink to &quot;KNXnetIP/Tunneling&quot;">​</a></h2><p>Когда выполнено подключение, шлюз отслеживает его состояния и переподключается если связь разрывается.</p><p>Подключиться можно из скриптов:</p><div class="language-lua vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">lua</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#79B8FF;">require</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;knx&quot;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">knx.</span><span style="color:#79B8FF;">beginIP</span><span style="color:#E1E4E8;">()</span></span>
<span class="line"><span style="color:#E1E4E8;">knx.</span><span style="color:#79B8FF;">connect</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;172.16.1.88&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">3671</span><span style="color:#E1E4E8;">)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#005CC5;">require</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;knx&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">knx.</span><span style="color:#005CC5;">beginIP</span><span style="color:#24292E;">()</span></span>
<span class="line"><span style="color:#24292E;">knx.</span><span style="color:#005CC5;">connect</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;172.16.1.88&quot;</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">3671</span><span style="color:#24292E;">)</span></span></code></pre></div><p>Отключение от IP Interface:</p><div class="language-lua vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">lua</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#79B8FF;">require</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;knx&quot;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">knx.</span><span style="color:#79B8FF;">disconnect</span><span style="color:#E1E4E8;">()</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#005CC5;">require</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;knx&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">knx.</span><span style="color:#005CC5;">disconnect</span><span style="color:#24292E;">()</span></span></code></pre></div><p>Возможно обнаружение в сети KNX IP Interface через функцию Discovery:</p><div class="language-lua vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">lua</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#79B8FF;">require</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;knx&quot;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">knx.</span><span style="color:#79B8FF;">beginIP</span><span style="color:#E1E4E8;">()</span></span>
<span class="line"><span style="color:#E1E4E8;">knx.</span><span style="color:#79B8FF;">discovery</span><span style="color:#E1E4E8;">()</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#005CC5;">require</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;knx&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">knx.</span><span style="color:#005CC5;">beginIP</span><span style="color:#24292E;">()</span></span>
<span class="line"><span style="color:#24292E;">knx.</span><span style="color:#005CC5;">discovery</span><span style="color:#24292E;">()</span></span></code></pre></div><p>Информация об обнаруженных интерфейсах отображается в логе.</p><h2 id="типы-данных" tabindex="-1">Типы данных <a class="header-anchor" href="#типы-данных" aria-label="Permalink to &quot;Типы данных&quot;">​</a></h2><p>Стандарт KNX содержит несколько сотен типов данных, но используются в большинстве случаев их небольшое число.</p><p>Если тип для группового объекта не задан (Undefined), то используется его фактическое представление (Raw), если его длина 1-6 бит, то он содержится в первом байте значения, если длина 1 байт и больше, что первый байт значения должен быть 0x00.</p><p>Ознакомится с полным списком возможных типов данных можно в официальной документации <a href="https://www.knx.org/wAssets/docs/downloads/Certification/Interworking-Datapoint-types/03_07_02-Datapoint-Types-v02.02.01-AS.pdf" target="_blank" rel="noreferrer">KNX</a>.</p><h3 id="поддерживаемые-типы-данных" tabindex="-1">Поддерживаемые типы данных <a class="header-anchor" href="#поддерживаемые-типы-данных" aria-label="Permalink to &quot;Поддерживаемые типы данных&quot;">​</a></h3><ul><li>1.001 DPT_Switch (Off / On)</li><li>3.007 DPT_Control_Dimming</li><li>5.000 DPT_1ByteUInt (Базовый тип, целое число 0 .. 255)</li><li>5.001 DPT_Scaling (Диапазон 0 .. 100 %)</li><li>5.003 DPT_Angle (Диапазон 0 .. 360 °)</li><li>6.000 DPT_1ByteInt (Базовый тип, целое число -128 .. 127)</li><li>7.000 DPT_2ByteUInt (Базовый тип, целое число 0 .. 65 535)</li><li>8.000 DPT_2ByteInt (Базовый тип, число -32 768 ... 32 767)</li><li>9.001 DPT_Value_Temp</li><li>10.001 DPT_TimeOfDay</li><li>11.001 DPT_Date</li><li>17.001 DPT_SceneNumber</li><li>19.001 DPT_DateTime</li></ul><p>Новые типы данных будут добавляться по мере необходимости.</p><h2 id="просмотр-базы" tabindex="-1">Просмотр базы <a class="header-anchor" href="#просмотр-базы" aria-label="Permalink to &quot;Просмотр базы&quot;">​</a></h2><p>Просмотр базы групповых объектов производится в веб-интерфейсе на странице <em>/knx</em>.</p><h2 id="mqtt" tabindex="-1">MQTT <a class="header-anchor" href="#mqtt" aria-label="Permalink to &quot;MQTT&quot;">​</a></h2><p>Для использования шлюза KNX-MQTT включите поддержку при инициализации <em>knx.beginIP(true)</em>.</p><p>Шлюз публикует значение сконфигурированного группового объекта в топик вида:</p><p><strong>knx/{GROUP_NAME}/{NAME}</strong></p><p>Для изменения значения группового необходимо передать значение в топик вида:</p><p><strong>knx/{GROUP_NAME}/{NAME}/set</strong></p><p>Для отправки запроса на чтение значения группового необходимо отправить любое значение в топик:</p><p><strong>knx/{GROUP_NAME}/{NAME}/get</strong></p><h2 id="http" tabindex="-1">HTTP <a class="header-anchor" href="#http" aria-label="Permalink to &quot;HTTP&quot;">​</a></h2><p>Прямое управление в разработке, на данный момент HTTP управление можно использовать через объекты.</p><h2 id="скрипты" tabindex="-1">Скрипты <a class="header-anchor" href="#скрипты" aria-label="Permalink to &quot;Скрипты&quot;">​</a></h2><p>Конфигурация группового объекта, задание типа и названия, а так же расположения:</p><div class="language-lua vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">lua</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#79B8FF;">require</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;knx&quot;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">knx.</span><span style="color:#79B8FF;">groupConf</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;1/2/200&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;DPT_Value_Temp&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;Actual temperature&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;room_1&quot;</span><span style="color:#E1E4E8;">)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#005CC5;">require</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;knx&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">knx.</span><span style="color:#005CC5;">groupConf</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;1/2/200&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;DPT_Value_Temp&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;Actual temperature&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;room_1&quot;</span><span style="color:#24292E;">)</span></span></code></pre></div><p>Запрос на чтение группового объекта:</p><div class="language-lua vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">lua</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#79B8FF;">require</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;knx&quot;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">knx.</span><span style="color:#79B8FF;">groupRead</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;1/1/10&quot;</span><span style="color:#E1E4E8;">)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#005CC5;">require</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;knx&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">knx.</span><span style="color:#005CC5;">groupRead</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;1/1/10&quot;</span><span style="color:#24292E;">)</span></span></code></pre></div><p>Полученные данные будут сохранены в БД.</p><p>Запрос на запись в групповой объект:</p><div class="language-lua vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">lua</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#79B8FF;">require</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;knx&quot;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">knx.</span><span style="color:#79B8FF;">groupWrite</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;1/1/10&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">0x01</span><span style="color:#E1E4E8;">)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#005CC5;">require</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;knx&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">knx.</span><span style="color:#005CC5;">groupWrite</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;1/1/10&quot;</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">0x01</span><span style="color:#24292E;">)</span></span></code></pre></div><p>Получение значения группового объекта из базы:</p><div class="language-lua vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">lua</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#79B8FF;">require</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;knx&quot;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">local</span><span style="color:#E1E4E8;"> sw </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> knx.</span><span style="color:#79B8FF;">groupValue</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;1/1/10&quot;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#79B8FF;">print</span><span style="color:#E1E4E8;">(sw)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#005CC5;">require</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;knx&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">local</span><span style="color:#24292E;"> sw </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> knx.</span><span style="color:#005CC5;">groupValue</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;1/1/10&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#005CC5;">print</span><span style="color:#24292E;">(sw)</span></span></code></pre></div>`,47),e=[o];function t(c,r,i,E,y,u){return a(),n("div",null,e)}const q=s(p,[["render",t]]);export{h as __pageData,q as default};
