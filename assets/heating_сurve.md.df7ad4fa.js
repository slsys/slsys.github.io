import{_ as s,o as n,c as a,Q as l}from"./chunks/framework.f1c0562b.js";const u=JSON.parse('{"title":"Вступление","description":"","frontmatter":{},"headers":[],"relativePath":"heating_сurve.md","filePath":"heating_сurve.md"}'),p={name:"heating_сurve.md"},o=l(`<h1 id="вступление" tabindex="-1">Вступление <a class="header-anchor" href="#вступление" aria-label="Permalink to &quot;Вступление&quot;">​</a></h1><p>Это заготовка статьи.</p><h1 id="управление-котлом-по-кривым-отопления" tabindex="-1">Управление котлом по кривым отопления <a class="header-anchor" href="#управление-котлом-по-кривым-отопления" aria-label="Permalink to &quot;Управление котлом по кривым отопления&quot;">​</a></h1><p>Это заготовка статьи.</p><p>Управление по заданному массиву ПЗА</p><p>Сценарий:</p><div class="language-lua vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">lua</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">--функция для поиска уставки в кривой отопления</span></span>
<span class="line"><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">getust</span><span style="color:#E1E4E8;">(tbl, val)</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> i </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">, </span><span style="color:#F97583;">#</span><span style="color:#E1E4E8;">tbl </span><span style="color:#F97583;">do</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;">        (tbl[i][</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">] </span><span style="color:#F97583;">&gt;=</span><span style="color:#E1E4E8;"> val )  </span><span style="color:#F97583;">then</span><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;">  tbl[i][</span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">]  </span><span style="color:#F97583;">end</span><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">end</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">30</span></span>
<span class="line"><span style="color:#F97583;">end</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">--функция для получения значения температуры с другого контроллера SLS. В примере используется Zigbee датчик температуры, размещенный на веранде. </span></span>
<span class="line"><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">getrequest</span><span style="color:#E1E4E8;">(url, ieee,name)</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> http.</span><span style="color:#79B8FF;">request2</span><span style="color:#E1E4E8;">(url</span><span style="color:#F97583;">..</span><span style="color:#9ECBFF;">&quot;/api/zigbee?dev=&quot;</span><span style="color:#F97583;">..</span><span style="color:#E1E4E8;">ieee</span><span style="color:#F97583;">..</span><span style="color:#9ECBFF;">&quot;&amp;action=getStateValue&amp;name=&quot;</span><span style="color:#F97583;">..</span><span style="color:#E1E4E8;">name</span><span style="color:#F97583;">..</span><span style="color:#9ECBFF;">&quot;&amp;token=e9d38bedb6412e.....ed9575&quot;</span><span style="color:#E1E4E8;">,</span><span style="color:#9ECBFF;">&quot;POST&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;Content-Type: text/text; charset=utf-8</span><span style="color:#79B8FF;">\\r\\n</span><span style="color:#9ECBFF;">&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;body&quot;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#F97583;">end</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">local</span><span style="color:#E1E4E8;"> url </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;http://192.168.1.48&quot;</span></span>
<span class="line"><span style="color:#F97583;">local</span><span style="color:#E1E4E8;">  temp_veranda </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">getrequest</span><span style="color:#E1E4E8;">(url, </span><span style="color:#9ECBFF;">&quot;0xA4C138A5A7994B63&quot;</span><span style="color:#E1E4E8;">,</span><span style="color:#9ECBFF;">&quot;temperature&quot;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">--функция расчета среднего значения.</span></span>
<span class="line"><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">math</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">average</span><span style="color:#E1E4E8;">(t)</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">local</span><span style="color:#E1E4E8;"> sum </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> _,v </span><span style="color:#F97583;">in</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">pairs</span><span style="color:#E1E4E8;">(t) </span><span style="color:#F97583;">do</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">-- Get the sum of all numbers in t</span></span>
<span class="line"><span style="color:#E1E4E8;">    sum </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> sum </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> v</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">end</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> sum </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">#</span><span style="color:#E1E4E8;">t</span></span>
<span class="line"><span style="color:#F97583;">end</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">--кривая отопления, может быть изменена в зависимости от теплоемкости помещения</span></span>
<span class="line"><span style="color:#F97583;">local</span><span style="color:#E1E4E8;"> krivaya </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> {    </span></span>
<span class="line"><span style="color:#E1E4E8;"> {</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">31</span><span style="color:#E1E4E8;">,</span><span style="color:#79B8FF;">52</span><span style="color:#E1E4E8;">},{</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">30</span><span style="color:#E1E4E8;">,</span><span style="color:#79B8FF;">51</span><span style="color:#E1E4E8;">},{</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">29</span><span style="color:#E1E4E8;">,</span><span style="color:#79B8FF;">50</span><span style="color:#E1E4E8;">},{</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">28</span><span style="color:#E1E4E8;">,</span><span style="color:#79B8FF;">49</span><span style="color:#E1E4E8;">},{</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">27</span><span style="color:#E1E4E8;">,</span><span style="color:#79B8FF;">48.5</span><span style="color:#E1E4E8;">},{</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">26</span><span style="color:#E1E4E8;">,</span><span style="color:#79B8FF;">48</span><span style="color:#E1E4E8;">},{</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">25</span><span style="color:#E1E4E8;">,</span><span style="color:#79B8FF;">47.5</span><span style="color:#E1E4E8;">}, {</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">24</span><span style="color:#E1E4E8;">,</span><span style="color:#79B8FF;">47</span><span style="color:#E1E4E8;">},{</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;">,</span><span style="color:#79B8FF;">46.5</span><span style="color:#E1E4E8;">},{</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">22</span><span style="color:#E1E4E8;">,</span><span style="color:#79B8FF;">46</span><span style="color:#E1E4E8;">}, {</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">21</span><span style="color:#E1E4E8;">,</span><span style="color:#79B8FF;">45.5</span><span style="color:#E1E4E8;">},{</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">20</span><span style="color:#E1E4E8;">,</span><span style="color:#79B8FF;">45</span><span style="color:#E1E4E8;">},{</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">19</span><span style="color:#E1E4E8;">,</span><span style="color:#79B8FF;">44.5</span><span style="color:#E1E4E8;">},{</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">18</span><span style="color:#E1E4E8;">,</span><span style="color:#79B8FF;">44</span><span style="color:#E1E4E8;">}, {</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">17</span><span style="color:#E1E4E8;">,</span><span style="color:#79B8FF;">43.5</span><span style="color:#E1E4E8;">},{</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">16</span><span style="color:#E1E4E8;">,</span><span style="color:#79B8FF;">43</span><span style="color:#E1E4E8;">},{</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">15</span><span style="color:#E1E4E8;">,</span><span style="color:#79B8FF;">42.5</span><span style="color:#E1E4E8;">},{</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">14</span><span style="color:#E1E4E8;">,</span><span style="color:#79B8FF;">42</span><span style="color:#E1E4E8;">},{</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">13</span><span style="color:#E1E4E8;">,</span><span style="color:#79B8FF;">41.5</span><span style="color:#E1E4E8;">},{</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">12</span><span style="color:#E1E4E8;">,</span><span style="color:#79B8FF;">41</span><span style="color:#E1E4E8;">},{</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">11</span><span style="color:#E1E4E8;">,</span><span style="color:#79B8FF;">40.5</span><span style="color:#E1E4E8;">},</span></span>
<span class="line"><span style="color:#E1E4E8;"> {</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">10</span><span style="color:#E1E4E8;">,</span><span style="color:#79B8FF;">40</span><span style="color:#E1E4E8;">}, {</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">9</span><span style="color:#E1E4E8;">,</span><span style="color:#79B8FF;">39.5</span><span style="color:#E1E4E8;">}, {</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">8</span><span style="color:#E1E4E8;">,</span><span style="color:#79B8FF;">39</span><span style="color:#E1E4E8;">}, {</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">7</span><span style="color:#E1E4E8;">,</span><span style="color:#79B8FF;">38.5</span><span style="color:#E1E4E8;">},{</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">6</span><span style="color:#E1E4E8;">,</span><span style="color:#79B8FF;">38</span><span style="color:#E1E4E8;">}, {</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">5</span><span style="color:#E1E4E8;">,</span><span style="color:#79B8FF;">37.5</span><span style="color:#E1E4E8;">},{</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">4</span><span style="color:#E1E4E8;">,</span><span style="color:#79B8FF;">37</span><span style="color:#E1E4E8;">}, {</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">3</span><span style="color:#E1E4E8;">,</span><span style="color:#79B8FF;">36.5</span><span style="color:#E1E4E8;">},{</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">,</span><span style="color:#79B8FF;">36</span><span style="color:#E1E4E8;">},{</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">,</span><span style="color:#79B8FF;">35.5</span><span style="color:#E1E4E8;">},{</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">,</span><span style="color:#79B8FF;">34</span><span style="color:#E1E4E8;">},{</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">,</span><span style="color:#79B8FF;">33.5</span><span style="color:#E1E4E8;">},{</span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">,</span><span style="color:#79B8FF;">33</span><span style="color:#E1E4E8;">},{</span><span style="color:#79B8FF;">3</span><span style="color:#E1E4E8;">,</span><span style="color:#79B8FF;">33</span><span style="color:#E1E4E8;">},{</span><span style="color:#79B8FF;">4</span><span style="color:#E1E4E8;">,</span><span style="color:#79B8FF;">33</span><span style="color:#E1E4E8;">},{</span><span style="color:#79B8FF;">5</span><span style="color:#E1E4E8;">,</span><span style="color:#79B8FF;">32.5</span><span style="color:#E1E4E8;">},{</span><span style="color:#79B8FF;">6</span><span style="color:#E1E4E8;">,</span><span style="color:#79B8FF;">32.5</span><span style="color:#E1E4E8;">},{</span><span style="color:#79B8FF;">7</span><span style="color:#E1E4E8;">,</span><span style="color:#79B8FF;">32</span><span style="color:#E1E4E8;">},{</span><span style="color:#79B8FF;">8</span><span style="color:#E1E4E8;">,</span><span style="color:#79B8FF;">32</span><span style="color:#E1E4E8;">},{</span><span style="color:#79B8FF;">9</span><span style="color:#E1E4E8;">,</span><span style="color:#79B8FF;">31.5</span><span style="color:#E1E4E8;">},{</span><span style="color:#79B8FF;">10</span><span style="color:#E1E4E8;">,</span><span style="color:#79B8FF;">31.5</span><span style="color:#E1E4E8;">},{</span><span style="color:#79B8FF;">11</span><span style="color:#E1E4E8;">,</span><span style="color:#79B8FF;">31</span><span style="color:#E1E4E8;">},{</span><span style="color:#79B8FF;">12</span><span style="color:#E1E4E8;">,</span><span style="color:#79B8FF;">31</span><span style="color:#E1E4E8;">},{</span><span style="color:#79B8FF;">13</span><span style="color:#E1E4E8;">,</span><span style="color:#79B8FF;">30</span><span style="color:#E1E4E8;">},{</span><span style="color:#79B8FF;">14</span><span style="color:#E1E4E8;">,</span><span style="color:#79B8FF;">25</span><span style="color:#E1E4E8;">},</span></span>
<span class="line"><span style="color:#E1E4E8;"> {</span><span style="color:#79B8FF;">15</span><span style="color:#E1E4E8;">,</span><span style="color:#79B8FF;">25</span><span style="color:#E1E4E8;">},{</span><span style="color:#79B8FF;">16</span><span style="color:#E1E4E8;">,</span><span style="color:#79B8FF;">25</span><span style="color:#E1E4E8;">},{</span><span style="color:#79B8FF;">17</span><span style="color:#E1E4E8;">,</span><span style="color:#79B8FF;">25</span><span style="color:#E1E4E8;">},{</span><span style="color:#79B8FF;">18</span><span style="color:#E1E4E8;">,</span><span style="color:#79B8FF;">25</span><span style="color:#E1E4E8;">},{</span><span style="color:#79B8FF;">19</span><span style="color:#E1E4E8;">,</span><span style="color:#79B8FF;">25</span><span style="color:#E1E4E8;">}}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">--</span></span>
<span class="line"><span style="color:#F97583;">local</span><span style="color:#E1E4E8;"> ul  </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;1w.28-96A907D6013C/temperature&#39;  						  </span><span style="color:#6A737D;">--датчик ds18b2, подключенный к SLS DIN MIN</span></span>
<span class="line"><span style="color:#F97583;">local</span><span style="color:#E1E4E8;"> ul_temp, prev_ul_temp </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> obj.</span><span style="color:#79B8FF;">get</span><span style="color:#E1E4E8;">(ul)    						  </span><span style="color:#6A737D;">--получение старого и нового значения уличной температуры</span></span>
<span class="line"><span style="color:#F97583;">local</span><span style="color:#E1E4E8;"> new_ust, prev_ust </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> obj.</span><span style="color:#79B8FF;">get</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;thermo.boiler.target_temperature&#39;</span><span style="color:#E1E4E8;">) </span><span style="color:#6A737D;">--получение текущего значения уставки </span></span>
<span class="line"><span style="color:#F97583;">local</span><span style="color:#E1E4E8;"> ul_ot, prev_ul_ot </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> obj.</span><span style="color:#79B8FF;">get</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;thermo.boiler.temperature_outside&#39;</span><span style="color:#E1E4E8;">)</span><span style="color:#6A737D;">--получение уличной темпетуры с котла по ОТ</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">--берем средние значения уличной температуры</span></span>
<span class="line"><span style="color:#F97583;">local</span><span style="color:#E1E4E8;"> ul_average</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">math.</span><span style="color:#79B8FF;">average</span><span style="color:#E1E4E8;">({ul_temp,ul_ot,temp_veranda})</span></span>
<span class="line"><span style="color:#F97583;">local</span><span style="color:#E1E4E8;"> temp_average, prev_temp_average   	  </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> obj.</span><span style="color:#79B8FF;">get</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;average_temp&quot;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">--вводим коээфициент теплоекмости</span></span>
<span class="line"><span style="color:#F97583;">local</span><span style="color:#E1E4E8;"> k</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">1.1</span></span>
<span class="line"><span style="color:#F97583;">local</span><span style="color:#E1E4E8;"> ust</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">getust</span><span style="color:#E1E4E8;">(krivaya, ul_temp)</span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;">k   </span><span style="color:#6A737D;">--рассчет необходимой температуры для внесения уставки</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">--меняем уставку при необходимости </span></span>
<span class="line"><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (ust</span><span style="color:#F97583;">~=</span><span style="color:#E1E4E8;">new_ust) </span><span style="color:#F97583;">then</span></span>
<span class="line"><span style="color:#E1E4E8;">telegram.</span><span style="color:#79B8FF;">send</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;На улице &quot;</span><span style="color:#F97583;">..</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">string.format</span><span style="color:#E1E4E8;"> (</span><span style="color:#9ECBFF;">&quot;%.2f&quot;</span><span style="color:#E1E4E8;">, ul_average) </span><span style="color:#F97583;">..</span><span style="color:#9ECBFF;">&quot;(&quot;</span><span style="color:#F97583;">..</span><span style="color:#E1E4E8;">ul_temp</span><span style="color:#F97583;">..</span><span style="color:#9ECBFF;">&quot;,&quot;</span><span style="color:#F97583;">..</span><span style="color:#E1E4E8;">ul_ot</span><span style="color:#F97583;">..</span><span style="color:#9ECBFF;">&quot;,&quot;</span><span style="color:#F97583;">..</span><span style="color:#E1E4E8;">temp_veranda</span><span style="color:#F97583;">..</span><span style="color:#9ECBFF;">&quot;), установлена уставка котла &quot;</span><span style="color:#F97583;">..</span><span style="color:#E1E4E8;">ust</span><span style="color:#F97583;">..</span><span style="color:#9ECBFF;">&quot; градусов, средняя температура в доме &quot;</span><span style="color:#F97583;">..</span><span style="color:#79B8FF;">string.format</span><span style="color:#E1E4E8;"> (</span><span style="color:#9ECBFF;">&quot;%.2f&quot;</span><span style="color:#E1E4E8;">, temp_average))</span></span>
<span class="line"><span style="color:#E1E4E8;">thermo.</span><span style="color:#79B8FF;">setBoilerTemperature</span><span style="color:#E1E4E8;">(ust)</span></span>
<span class="line"><span style="color:#F97583;">end</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">--функция для поиска уставки в кривой отопления</span></span>
<span class="line"><span style="color:#D73A49;">function</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">getust</span><span style="color:#24292E;">(tbl, val)</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">for</span><span style="color:#24292E;"> i </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">, </span><span style="color:#D73A49;">#</span><span style="color:#24292E;">tbl </span><span style="color:#D73A49;">do</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">if</span><span style="color:#24292E;">        (tbl[i][</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">] </span><span style="color:#D73A49;">&gt;=</span><span style="color:#24292E;"> val )  </span><span style="color:#D73A49;">then</span><span style="color:#24292E;">  </span><span style="color:#D73A49;">return</span><span style="color:#24292E;">  tbl[i][</span><span style="color:#005CC5;">2</span><span style="color:#24292E;">]  </span><span style="color:#D73A49;">end</span><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">end</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">30</span></span>
<span class="line"><span style="color:#D73A49;">end</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">--функция для получения значения температуры с другого контроллера SLS. В примере используется Zigbee датчик температуры, размещенный на веранде. </span></span>
<span class="line"><span style="color:#D73A49;">function</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">getrequest</span><span style="color:#24292E;">(url, ieee,name)</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> http.</span><span style="color:#005CC5;">request2</span><span style="color:#24292E;">(url</span><span style="color:#D73A49;">..</span><span style="color:#032F62;">&quot;/api/zigbee?dev=&quot;</span><span style="color:#D73A49;">..</span><span style="color:#24292E;">ieee</span><span style="color:#D73A49;">..</span><span style="color:#032F62;">&quot;&amp;action=getStateValue&amp;name=&quot;</span><span style="color:#D73A49;">..</span><span style="color:#24292E;">name</span><span style="color:#D73A49;">..</span><span style="color:#032F62;">&quot;&amp;token=e9d38bedb6412e.....ed9575&quot;</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&quot;POST&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;Content-Type: text/text; charset=utf-8</span><span style="color:#005CC5;">\\r\\n</span><span style="color:#032F62;">&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;body&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#D73A49;">end</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">local</span><span style="color:#24292E;"> url </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;http://192.168.1.48&quot;</span></span>
<span class="line"><span style="color:#D73A49;">local</span><span style="color:#24292E;">  temp_veranda </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">getrequest</span><span style="color:#24292E;">(url, </span><span style="color:#032F62;">&quot;0xA4C138A5A7994B63&quot;</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&quot;temperature&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">--функция расчета среднего значения.</span></span>
<span class="line"><span style="color:#D73A49;">function</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">math</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">average</span><span style="color:#24292E;">(t)</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">local</span><span style="color:#24292E;"> sum </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">for</span><span style="color:#24292E;"> _,v </span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">pairs</span><span style="color:#24292E;">(t) </span><span style="color:#D73A49;">do</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">-- Get the sum of all numbers in t</span></span>
<span class="line"><span style="color:#24292E;">    sum </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> sum </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> v</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">end</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> sum </span><span style="color:#D73A49;">/</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">#</span><span style="color:#24292E;">t</span></span>
<span class="line"><span style="color:#D73A49;">end</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">--кривая отопления, может быть изменена в зависимости от теплоемкости помещения</span></span>
<span class="line"><span style="color:#D73A49;">local</span><span style="color:#24292E;"> krivaya </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> {    </span></span>
<span class="line"><span style="color:#24292E;"> {</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">31</span><span style="color:#24292E;">,</span><span style="color:#005CC5;">52</span><span style="color:#24292E;">},{</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">30</span><span style="color:#24292E;">,</span><span style="color:#005CC5;">51</span><span style="color:#24292E;">},{</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">29</span><span style="color:#24292E;">,</span><span style="color:#005CC5;">50</span><span style="color:#24292E;">},{</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">28</span><span style="color:#24292E;">,</span><span style="color:#005CC5;">49</span><span style="color:#24292E;">},{</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">27</span><span style="color:#24292E;">,</span><span style="color:#005CC5;">48.5</span><span style="color:#24292E;">},{</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">26</span><span style="color:#24292E;">,</span><span style="color:#005CC5;">48</span><span style="color:#24292E;">},{</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">25</span><span style="color:#24292E;">,</span><span style="color:#005CC5;">47.5</span><span style="color:#24292E;">}, {</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">24</span><span style="color:#24292E;">,</span><span style="color:#005CC5;">47</span><span style="color:#24292E;">},{</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">23</span><span style="color:#24292E;">,</span><span style="color:#005CC5;">46.5</span><span style="color:#24292E;">},{</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">22</span><span style="color:#24292E;">,</span><span style="color:#005CC5;">46</span><span style="color:#24292E;">}, {</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">21</span><span style="color:#24292E;">,</span><span style="color:#005CC5;">45.5</span><span style="color:#24292E;">},{</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">20</span><span style="color:#24292E;">,</span><span style="color:#005CC5;">45</span><span style="color:#24292E;">},{</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">19</span><span style="color:#24292E;">,</span><span style="color:#005CC5;">44.5</span><span style="color:#24292E;">},{</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">18</span><span style="color:#24292E;">,</span><span style="color:#005CC5;">44</span><span style="color:#24292E;">}, {</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">17</span><span style="color:#24292E;">,</span><span style="color:#005CC5;">43.5</span><span style="color:#24292E;">},{</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">16</span><span style="color:#24292E;">,</span><span style="color:#005CC5;">43</span><span style="color:#24292E;">},{</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">15</span><span style="color:#24292E;">,</span><span style="color:#005CC5;">42.5</span><span style="color:#24292E;">},{</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">14</span><span style="color:#24292E;">,</span><span style="color:#005CC5;">42</span><span style="color:#24292E;">},{</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">13</span><span style="color:#24292E;">,</span><span style="color:#005CC5;">41.5</span><span style="color:#24292E;">},{</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">12</span><span style="color:#24292E;">,</span><span style="color:#005CC5;">41</span><span style="color:#24292E;">},{</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">11</span><span style="color:#24292E;">,</span><span style="color:#005CC5;">40.5</span><span style="color:#24292E;">},</span></span>
<span class="line"><span style="color:#24292E;"> {</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">10</span><span style="color:#24292E;">,</span><span style="color:#005CC5;">40</span><span style="color:#24292E;">}, {</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">9</span><span style="color:#24292E;">,</span><span style="color:#005CC5;">39.5</span><span style="color:#24292E;">}, {</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">8</span><span style="color:#24292E;">,</span><span style="color:#005CC5;">39</span><span style="color:#24292E;">}, {</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">7</span><span style="color:#24292E;">,</span><span style="color:#005CC5;">38.5</span><span style="color:#24292E;">},{</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">6</span><span style="color:#24292E;">,</span><span style="color:#005CC5;">38</span><span style="color:#24292E;">}, {</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">5</span><span style="color:#24292E;">,</span><span style="color:#005CC5;">37.5</span><span style="color:#24292E;">},{</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">4</span><span style="color:#24292E;">,</span><span style="color:#005CC5;">37</span><span style="color:#24292E;">}, {</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">3</span><span style="color:#24292E;">,</span><span style="color:#005CC5;">36.5</span><span style="color:#24292E;">},{</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">2</span><span style="color:#24292E;">,</span><span style="color:#005CC5;">36</span><span style="color:#24292E;">},{</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">,</span><span style="color:#005CC5;">35.5</span><span style="color:#24292E;">},{</span><span style="color:#005CC5;">0</span><span style="color:#24292E;">,</span><span style="color:#005CC5;">34</span><span style="color:#24292E;">},{</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">,</span><span style="color:#005CC5;">33.5</span><span style="color:#24292E;">},{</span><span style="color:#005CC5;">2</span><span style="color:#24292E;">,</span><span style="color:#005CC5;">33</span><span style="color:#24292E;">},{</span><span style="color:#005CC5;">3</span><span style="color:#24292E;">,</span><span style="color:#005CC5;">33</span><span style="color:#24292E;">},{</span><span style="color:#005CC5;">4</span><span style="color:#24292E;">,</span><span style="color:#005CC5;">33</span><span style="color:#24292E;">},{</span><span style="color:#005CC5;">5</span><span style="color:#24292E;">,</span><span style="color:#005CC5;">32.5</span><span style="color:#24292E;">},{</span><span style="color:#005CC5;">6</span><span style="color:#24292E;">,</span><span style="color:#005CC5;">32.5</span><span style="color:#24292E;">},{</span><span style="color:#005CC5;">7</span><span style="color:#24292E;">,</span><span style="color:#005CC5;">32</span><span style="color:#24292E;">},{</span><span style="color:#005CC5;">8</span><span style="color:#24292E;">,</span><span style="color:#005CC5;">32</span><span style="color:#24292E;">},{</span><span style="color:#005CC5;">9</span><span style="color:#24292E;">,</span><span style="color:#005CC5;">31.5</span><span style="color:#24292E;">},{</span><span style="color:#005CC5;">10</span><span style="color:#24292E;">,</span><span style="color:#005CC5;">31.5</span><span style="color:#24292E;">},{</span><span style="color:#005CC5;">11</span><span style="color:#24292E;">,</span><span style="color:#005CC5;">31</span><span style="color:#24292E;">},{</span><span style="color:#005CC5;">12</span><span style="color:#24292E;">,</span><span style="color:#005CC5;">31</span><span style="color:#24292E;">},{</span><span style="color:#005CC5;">13</span><span style="color:#24292E;">,</span><span style="color:#005CC5;">30</span><span style="color:#24292E;">},{</span><span style="color:#005CC5;">14</span><span style="color:#24292E;">,</span><span style="color:#005CC5;">25</span><span style="color:#24292E;">},</span></span>
<span class="line"><span style="color:#24292E;"> {</span><span style="color:#005CC5;">15</span><span style="color:#24292E;">,</span><span style="color:#005CC5;">25</span><span style="color:#24292E;">},{</span><span style="color:#005CC5;">16</span><span style="color:#24292E;">,</span><span style="color:#005CC5;">25</span><span style="color:#24292E;">},{</span><span style="color:#005CC5;">17</span><span style="color:#24292E;">,</span><span style="color:#005CC5;">25</span><span style="color:#24292E;">},{</span><span style="color:#005CC5;">18</span><span style="color:#24292E;">,</span><span style="color:#005CC5;">25</span><span style="color:#24292E;">},{</span><span style="color:#005CC5;">19</span><span style="color:#24292E;">,</span><span style="color:#005CC5;">25</span><span style="color:#24292E;">}}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">--</span></span>
<span class="line"><span style="color:#D73A49;">local</span><span style="color:#24292E;"> ul  </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;1w.28-96A907D6013C/temperature&#39;  						  </span><span style="color:#6A737D;">--датчик ds18b2, подключенный к SLS DIN MIN</span></span>
<span class="line"><span style="color:#D73A49;">local</span><span style="color:#24292E;"> ul_temp, prev_ul_temp </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> obj.</span><span style="color:#005CC5;">get</span><span style="color:#24292E;">(ul)    						  </span><span style="color:#6A737D;">--получение старого и нового значения уличной температуры</span></span>
<span class="line"><span style="color:#D73A49;">local</span><span style="color:#24292E;"> new_ust, prev_ust </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> obj.</span><span style="color:#005CC5;">get</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;thermo.boiler.target_temperature&#39;</span><span style="color:#24292E;">) </span><span style="color:#6A737D;">--получение текущего значения уставки </span></span>
<span class="line"><span style="color:#D73A49;">local</span><span style="color:#24292E;"> ul_ot, prev_ul_ot </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> obj.</span><span style="color:#005CC5;">get</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;thermo.boiler.temperature_outside&#39;</span><span style="color:#24292E;">)</span><span style="color:#6A737D;">--получение уличной темпетуры с котла по ОТ</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">--берем средние значения уличной температуры</span></span>
<span class="line"><span style="color:#D73A49;">local</span><span style="color:#24292E;"> ul_average</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">math.</span><span style="color:#005CC5;">average</span><span style="color:#24292E;">({ul_temp,ul_ot,temp_veranda})</span></span>
<span class="line"><span style="color:#D73A49;">local</span><span style="color:#24292E;"> temp_average, prev_temp_average   	  </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> obj.</span><span style="color:#005CC5;">get</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;average_temp&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">--вводим коээфициент теплоекмости</span></span>
<span class="line"><span style="color:#D73A49;">local</span><span style="color:#24292E;"> k</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">1.1</span></span>
<span class="line"><span style="color:#D73A49;">local</span><span style="color:#24292E;"> ust</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">getust</span><span style="color:#24292E;">(krivaya, ul_temp)</span><span style="color:#D73A49;">*</span><span style="color:#24292E;">k   </span><span style="color:#6A737D;">--рассчет необходимой температуры для внесения уставки</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">--меняем уставку при необходимости </span></span>
<span class="line"><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (ust</span><span style="color:#D73A49;">~=</span><span style="color:#24292E;">new_ust) </span><span style="color:#D73A49;">then</span></span>
<span class="line"><span style="color:#24292E;">telegram.</span><span style="color:#005CC5;">send</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;На улице &quot;</span><span style="color:#D73A49;">..</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">string.format</span><span style="color:#24292E;"> (</span><span style="color:#032F62;">&quot;%.2f&quot;</span><span style="color:#24292E;">, ul_average) </span><span style="color:#D73A49;">..</span><span style="color:#032F62;">&quot;(&quot;</span><span style="color:#D73A49;">..</span><span style="color:#24292E;">ul_temp</span><span style="color:#D73A49;">..</span><span style="color:#032F62;">&quot;,&quot;</span><span style="color:#D73A49;">..</span><span style="color:#24292E;">ul_ot</span><span style="color:#D73A49;">..</span><span style="color:#032F62;">&quot;,&quot;</span><span style="color:#D73A49;">..</span><span style="color:#24292E;">temp_veranda</span><span style="color:#D73A49;">..</span><span style="color:#032F62;">&quot;), установлена уставка котла &quot;</span><span style="color:#D73A49;">..</span><span style="color:#24292E;">ust</span><span style="color:#D73A49;">..</span><span style="color:#032F62;">&quot; градусов, средняя температура в доме &quot;</span><span style="color:#D73A49;">..</span><span style="color:#005CC5;">string.format</span><span style="color:#24292E;"> (</span><span style="color:#032F62;">&quot;%.2f&quot;</span><span style="color:#24292E;">, temp_average))</span></span>
<span class="line"><span style="color:#24292E;">thermo.</span><span style="color:#005CC5;">setBoilerTemperature</span><span style="color:#24292E;">(ust)</span></span>
<span class="line"><span style="color:#D73A49;">end</span></span></code></pre></div><p>Управление по апроксимированным кривым отопления ПЗА от @Deimon9603 на основе <a href="https://wdn.su/blog/1154" target="_blank" rel="noreferrer">статьи</a></p><div class="language-lua vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">lua</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">local</span><span style="color:#E1E4E8;"> ul  </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;1w.28-D16D2A4E2001/temperature&quot;    </span><span style="color:#6A737D;">--установленный на улице датчик температуры  </span></span>
<span class="line"><span style="color:#F97583;">local</span><span style="color:#E1E4E8;"> ul_temp </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> obj.</span><span style="color:#79B8FF;">get</span><span style="color:#E1E4E8;">(ul)  </span></span>
<span class="line"><span style="color:#F97583;">local</span><span style="color:#E1E4E8;"> k </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0.4</span><span style="color:#E1E4E8;">                                   </span><span style="color:#6A737D;">--коэффициент отопительной кривой (изменяется в зависимости от теплового контура дома)</span></span>
<span class="line"><span style="color:#F97583;">local</span><span style="color:#E1E4E8;"> a </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">0.21</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> k </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0.06</span></span>
<span class="line"><span style="color:#F97583;">local</span><span style="color:#E1E4E8;"> b </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">6.04</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> k </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1.98</span></span>
<span class="line"><span style="color:#F97583;">local</span><span style="color:#E1E4E8;"> c </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">5.06</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> k </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">18.06</span></span>
<span class="line"><span style="color:#F97583;">local</span><span style="color:#E1E4E8;"> x </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">0.2</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> ul_temp </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5</span><span style="color:#E1E4E8;">     </span></span>
<span class="line"><span style="color:#F97583;">local</span><span style="color:#E1E4E8;"> new_ust </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">math.floor</span><span style="color:#E1E4E8;"> ((a </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> x </span><span style="color:#F97583;">^</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> (b </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> x) </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> c)</span></span>
<span class="line"><span style="color:#F97583;">local</span><span style="color:#E1E4E8;"> ust </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> obj.</span><span style="color:#79B8FF;">get</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;thermo.boiler.target_temperature&quot;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#F97583;">local</span><span style="color:#E1E4E8;"> min_temp </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">35</span><span style="color:#E1E4E8;">                             </span><span style="color:#6A737D;">-- уставка минимальной температуры теплоносителя</span></span>
<span class="line"><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> new_ust </span><span style="color:#F97583;">==</span><span style="color:#E1E4E8;"> min_temp </span><span style="color:#F97583;">then</span><span style="color:#E1E4E8;">                     </span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">end</span></span>
<span class="line"><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> new_ust </span><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;"> min_temp </span><span style="color:#F97583;">then</span></span>
<span class="line"><span style="color:#E1E4E8;">   thermo.</span><span style="color:#79B8FF;">setBoilerTemperature</span><span style="color:#E1E4E8;">(min_temp)</span></span>
<span class="line"><span style="color:#F97583;">end</span></span>
<span class="line"><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> ust </span><span style="color:#F97583;">~=</span><span style="color:#E1E4E8;"> new_ust </span><span style="color:#F97583;">then</span></span>
<span class="line"><span style="color:#E1E4E8;">   thermo.</span><span style="color:#79B8FF;">setBoilerTemperature</span><span style="color:#E1E4E8;">(new_ust)</span></span>
<span class="line"><span style="color:#F97583;">end</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">local</span><span style="color:#24292E;"> ul  </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;1w.28-D16D2A4E2001/temperature&quot;    </span><span style="color:#6A737D;">--установленный на улице датчик температуры  </span></span>
<span class="line"><span style="color:#D73A49;">local</span><span style="color:#24292E;"> ul_temp </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> obj.</span><span style="color:#005CC5;">get</span><span style="color:#24292E;">(ul)  </span></span>
<span class="line"><span style="color:#D73A49;">local</span><span style="color:#24292E;"> k </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0.4</span><span style="color:#24292E;">                                   </span><span style="color:#6A737D;">--коэффициент отопительной кривой (изменяется в зависимости от теплового контура дома)</span></span>
<span class="line"><span style="color:#D73A49;">local</span><span style="color:#24292E;"> a </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">0.21</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> k </span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0.06</span></span>
<span class="line"><span style="color:#D73A49;">local</span><span style="color:#24292E;"> b </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">6.04</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> k </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1.98</span></span>
<span class="line"><span style="color:#D73A49;">local</span><span style="color:#24292E;"> c </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">5.06</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> k </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">18.06</span></span>
<span class="line"><span style="color:#D73A49;">local</span><span style="color:#24292E;"> x </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">0.2</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> ul_temp </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5</span><span style="color:#24292E;">     </span></span>
<span class="line"><span style="color:#D73A49;">local</span><span style="color:#24292E;"> new_ust </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">math.floor</span><span style="color:#24292E;"> ((a </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> x </span><span style="color:#D73A49;">^</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> (b </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> x) </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> c)</span></span>
<span class="line"><span style="color:#D73A49;">local</span><span style="color:#24292E;"> ust </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> obj.</span><span style="color:#005CC5;">get</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;thermo.boiler.target_temperature&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#D73A49;">local</span><span style="color:#24292E;"> min_temp </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">35</span><span style="color:#24292E;">                             </span><span style="color:#6A737D;">-- уставка минимальной температуры теплоносителя</span></span>
<span class="line"><span style="color:#D73A49;">if</span><span style="color:#24292E;"> new_ust </span><span style="color:#D73A49;">==</span><span style="color:#24292E;"> min_temp </span><span style="color:#D73A49;">then</span><span style="color:#24292E;">                     </span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">end</span></span>
<span class="line"><span style="color:#D73A49;">if</span><span style="color:#24292E;"> new_ust </span><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;"> min_temp </span><span style="color:#D73A49;">then</span></span>
<span class="line"><span style="color:#24292E;">   thermo.</span><span style="color:#005CC5;">setBoilerTemperature</span><span style="color:#24292E;">(min_temp)</span></span>
<span class="line"><span style="color:#D73A49;">end</span></span>
<span class="line"><span style="color:#D73A49;">if</span><span style="color:#24292E;"> ust </span><span style="color:#D73A49;">~=</span><span style="color:#24292E;"> new_ust </span><span style="color:#D73A49;">then</span></span>
<span class="line"><span style="color:#24292E;">   thermo.</span><span style="color:#005CC5;">setBoilerTemperature</span><span style="color:#24292E;">(new_ust)</span></span>
<span class="line"><span style="color:#D73A49;">end</span></span></code></pre></div><h1 id="управление-pid-регулированием" tabindex="-1">Управление PID-регулированием <a class="header-anchor" href="#управление-pid-регулированием" aria-label="Permalink to &quot;Управление PID-регулированием&quot;">​</a></h1><p>Это заготовка статьи.</p><h1 id="полезные-ссылки" tabindex="-1">Полезные ссылки: <a class="header-anchor" href="#полезные-ссылки" aria-label="Permalink to &quot;Полезные ссылки:&quot;">​</a></h1><p><a href="https://wdn.su/blog/1154" target="_blank" rel="noreferrer">Логика управления котлом Vaillant</a></p><p><a href="https://habr.com/ru/post/145991/" target="_blank" rel="noreferrer">ПИД-регулятор своими руками</a></p><p><a href="https://alexgyver.ru/lessons/pid" target="_blank" rel="noreferrer">ПИД РЕГУЛЯТОР (урок от AlexGyver)</a></p><p><a href="https://dzen.ru/a/X5J1nrKM8FGEFVn4" target="_blank" rel="noreferrer">Кривая отопления. Что это и как ее настроить? (заметка на Дзене)</a></p><p><a href="https://igorkandaurov.com/2022/10/12/sls-%D1%83%D0%BF%D1%80%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5-%D0%B3%D0%B0%D0%B7%D0%BE%D0%B2%D1%8B%D0%BC-%D0%BA%D0%BE%D1%82%D0%BB%D0%BE%D0%BC/" target="_blank" rel="noreferrer">SLS: управление газовым котлом (заметка от Igor Kandaurov)</a></p>`,17),e=[o];function t(r,c,y,E,F,C){return n(),a("div",null,e)}const D=s(p,[["render",t]]);export{u as __pageData,D as default};
