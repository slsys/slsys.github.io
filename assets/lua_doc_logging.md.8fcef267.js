import{_ as s,o as a,c as l,Q as n}from"./chunks/framework.f1c0562b.js";const g=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"lua_doc/logging.md","filePath":"lua_doc/logging.md"}'),o={name:"lua_doc/logging.md"},e=n(`<h2 id="задача" tabindex="-1">Задача <a class="header-anchor" href="#задача" aria-label="Permalink to &quot;Задача&quot;">​</a></h2><p>Настроить постоянное логирование SLS. Для удобства будем ротировать журналы:</p><ul><li>ежедневно</li><li>размер от 10М</li><li>старые журналы сжимать</li><li>хранить до 30 дней</li></ul><h2 id="включение-udp-log" tabindex="-1">Включение UDP LOG <a class="header-anchor" href="#включение-udp-log" aria-label="Permalink to &quot;Включение UDP LOG&quot;">​</a></h2><p>В lua необходимо выполнить команду</p><div class="language-lua vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">lua</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">os.</span><span style="color:#79B8FF;">udplogenable</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;">)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">os.</span><span style="color:#005CC5;">udplogenable</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">true</span><span style="color:#24292E;">)</span></span></code></pre></div><h2 id="логирование-в-linux" tabindex="-1">Логирование в Linux <a class="header-anchor" href="#логирование-в-linux" aria-label="Permalink to &quot;Логирование в Linux&quot;">​</a></h2><p><code>nc -ulnk 45678</code></p><h3 id="постоянныи-лог-в-фаил-с-ротациеи-в-linux" tabindex="-1">Постоянный лог в файл с ротацией в Linux <a class="header-anchor" href="#постоянныи-лог-в-фаил-с-ротациеи-в-linux" aria-label="Permalink to &quot;Постоянный лог в файл с ротацией в Linux&quot;">​</a></h3><h4 id="запуск-логирования-при-старте-ос" tabindex="-1">Запуск логирования при старте ОС <a class="header-anchor" href="#запуск-логирования-при-старте-ос" aria-label="Permalink to &quot;Запуск логирования при старте ОС&quot;">​</a></h4><h5 id="способ-с-cron-в-crontab-добавить-строку-reboot-nc-ulnk-45678-var-log-sls-debug-log" tabindex="-1">Способ с CRON. В crontab добавить строку <code>@reboot nc -ulnk 45678 &gt;&gt; /var/log/sls/debug.log</code> <a class="header-anchor" href="#способ-с-cron-в-crontab-добавить-строку-reboot-nc-ulnk-45678-var-log-sls-debug-log" aria-label="Permalink to &quot;Способ с CRON. В crontab добавить строку \`@reboot nc -ulnk 45678 &gt;&gt; /var/log/sls/debug.log\`&quot;">​</a></h5><h4 id="ротация-лога-с-помощью-logrotate" tabindex="-1">Ротация лога с помощью logrotate <a class="header-anchor" href="#ротация-лога-с-помощью-logrotate" aria-label="Permalink to &quot;Ротация лога с помощью logrotate&quot;">​</a></h4><p>Создать конфиг в <code>/etc/logrotate.d</code></p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">/var/log/sls/debug.log {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#FDAEB7;font-style:italic;">rotate</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;font-style:italic;">30</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#FDAEB7;font-style:italic;">daily</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#FDAEB7;font-style:italic;">minsize=10M</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#FDAEB7;font-style:italic;">missingok</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#FDAEB7;font-style:italic;">notifempty</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#FDAEB7;font-style:italic;">compress</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#FDAEB7;font-style:italic;">delaycompress</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#FDAEB7;font-style:italic;">maxage</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;font-style:italic;">30</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#FDAEB7;font-style:italic;">copytruncate</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">/var/log/sls/debug.log {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#B31D28;font-style:italic;">rotate</span><span style="color:#24292E;"> </span><span style="color:#B31D28;font-style:italic;">30</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#B31D28;font-style:italic;">daily</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#B31D28;font-style:italic;">minsize=10M</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#B31D28;font-style:italic;">missingok</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#B31D28;font-style:italic;">notifempty</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#B31D28;font-style:italic;">compress</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#B31D28;font-style:italic;">delaycompress</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#B31D28;font-style:italic;">maxage</span><span style="color:#24292E;"> </span><span style="color:#B31D28;font-style:italic;">30</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#B31D28;font-style:italic;">copytruncate</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div>`,14),t=[e];function p(c,i,r,y,d,E){return a(),l("div",null,t)}const h=s(o,[["render",p]]);export{g as __pageData,h as default};
